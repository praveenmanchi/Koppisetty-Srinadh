---
import { getCollection } from 'astro:content';
import WorkLayout from '../../layouts/WorkLayout.astro';

export async function getStaticPaths() {
  const work = await getCollection('work');
  return work.map(page => ({
    params: { slug: page.slug },
    props: { page },
    trailingSlash: false,
  }));
}

const { page } = Astro.props;

// Re-fetch all work entries
const allWork = await getCollection('work');

// Optionally filter if needed (e.g., missing titles)
const validWork = allWork.filter(item => item.data?.title);

// You can sort alphabetically if you want, or leave as-is for collection order
const sorted = validWork; // or: validWork.sort((a, b) => a.data.title.localeCompare(b.data.title));

const index = sorted.findIndex(item => item.slug === page.slug);
const previous = sorted[index - 1] || null;
const next = sorted[index + 1] || null;

const { Content } = await page.render();
---

<WorkLayout frontmatter={page.data} previous={previous} next={next}>
  <Content />
</WorkLayout>