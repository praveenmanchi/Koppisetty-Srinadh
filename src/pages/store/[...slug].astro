---
import { getCollection } from 'astro:content';
import StoreLayout from '../../layouts/StoreLayout.astro';

export async function getStaticPaths() {
  const store = await getCollection('store');
  return store.map(page => ({
    params: { slug: page.slug },
    props: { page },
    trailingSlash: false,
  }));
}

const { page } = Astro.props;

// Fetch and optionally filter valid store entries
const allStore = await getCollection('store');
const validStore = allStore.filter(item => item.data?.title); // adjust if needed

// Optional: sort alphabetically or by a custom field
const sorted = validStore; // or: validStore.sort((a, b) => a.data.title.localeCompare(b.data.title))

// Find previous and next items
const index = sorted.findIndex(item => item.slug === page.slug);
const previous = sorted[index - 1] || null;
const next = sorted[index + 1] || null;

const { Content } = await page.render();
---

<StoreLayout frontmatter={page.data} previous={previous} next={next}>
  <Content />
</StoreLayout>
